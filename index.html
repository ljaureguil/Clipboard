<html>

<head id="h1">
    <meta name="viewport" content="width=device-width">
</head>

<style id="s1">
    body {
        text-align: center;
        font-size: 25px;
        margin: 20px;
        background:white;
    }
    code# {
        margin: 5%;
        width: 10%;
        position: absolute;
        bottom:2%;
        right:1%;
    }
    button {
        font-size: 25px;
        border-radius: 10px;
        background: orange;
        margin:4px;
        color: white;
    }
    #reader {
        width: 100%;
        color: white;
        font-size: 25px;
    }
    #ta {
        width: 95%;
        display: none;
    }
    #tx {
        margin: 5%;
        width: 90%;
        font-size: 35px;
        height: 20%;
        background-color: rgb(14, 236, 118);
        display: none;
    }
  #dor{
        position: absolute;
        text-align: left;
        padding:15px;
        top:5%;
        width: 50%;
        left: 25%;
        z-index: 2;
        border-style: solid;
        background-color: rgb(154, 209, 180);
        display: none;
        height:130%;
    }
    .cin{
        text-align: right;     
    }
    #de{
        height: auto;

    }
    
    #tfil{
       width:60%; 
       height:4%;
           text-align: left;
           margin:5px;;
           
        
   }  
  .ctt{
   width:90%;
   margin:5%;
   border:solid;
   font-size: 14px;
   display: block;
       background:white;
   
}  
      #dinv{
       width: 70%;
       height:40%;
       overflow: auto;
       border-radius: 5px;;
       border-style: solid;
       display:none;
    //   background:black;
   }
   #scla{
       display:none;
   }
   
</style>
-- Search/Manually...<br>
 <textarea id="tfil" oninput="search(this.value)"></textarea><br>
    
<div id="dinv"></div><div id="dparts"></div>
<div id="reader"></div>
<br>

<div id="res">
  
    <a id="ta" href="" target="_blank"></a>

    <textarea id="tx"></textarea>
</div>

 <div id="dor"> 
    Job No. <input id="jn" type="text" class="cin"><br>
    Qty: <input id="qt" type="number" class="cin"><br>
 Inv. Class:<input id="cla" type="text" class="cin"><br>
  <Select id="scla" type="text" class="cin">
  <option>inv</option>
  <option>misc</option>
   <option>other</option>
   
  </select>

 
 
Kw: <input id="kw" type="text" class="cin"><br>
Qty Obs: <input id="obs" type="number" class="cin"><br>

 Part No. <input id="pno" type="text" class="cin"><br>
 desc: <input id="de" type="text" class="cin"><br>
  Mech <input id="mec" type="text" class="cin"><br> 
 Loc <input id="loc" type="text" class="cin"><br> 
 Note <input id="no" type="text" class="cin"><br>     
  <button class="cpu" onclick="dor.style.display='none';send('other',dor.name)">Send To Clipboard</button><br>
 <button class="cpu" onclick="dor.style.display='none'">Close</button>
   
</div>

<script src="Misc/html5-qrcode.min.js"></script>


<script>
//var user=localStorage.getItem("mec");
//if(user===null) { user=prompt("Type your name");localStorage.setItem("mec",user);
     var linkp = 'https://jsonblob.com/api/d0317ef4-f48e-11eb-9b1d-755fd0c1d5cb';
     var linkc = 'https://jsonblob.com/api/0da2d184-f931-11eb-a6a9-8d2736c2c513'
     var linkme='http://jsonblob.com/api/893891925422391296';//my clipboard
     
        var linkm = 'https://jsonblob.com/api/d0317ef4-f48e-11eb-9b1d-755fd0c1d5cb';//miselanius
    linkb="https://jsonblob.com/api/893339508880457728";//basquet
    linkp="https://jsonblob.com/api/892533157149294592";//main
    linko="https://jsonblob.com/api/893246438927253504";//other
    linkt='https://jsonblob.com/api/893855119448489984';//trash
    var Parts=[],Psel=[];
    
     getInventories();
     
     
     
      var mecanico=""
       mecanico=localStorage.getItem("mec");
     
                if(mecanico===null || mecanico===""){
                    mecanico=prompt("Type your Name");
                    localStorage.setItem("mec",mecanico);
                       }
                else{
                    alert("Hi "+mecanico);

                }
    var s = document.getElementsByTagName("style")[0];
    var html5QrcodeScanner = new Html5QrcodeScanner(
        "reader", {
            fps: 10,
            qrbox: 250
        });
    html5QrcodeScanner.render(onScanSuccess, onScanError);

    function onScanSuccess(decodedText, decodedResult) {
        alert(decodedText);
        pno.value=""
        qt.value="";
        jn.value="";
        no.value="";
        me.value="";
        de.value="";
        da.value="";


             de.value="";
             me.value="";
        if (decodedText.indexOf("http") > -1){
 //            ta.style.display = "block";
      //  ta.click();
            ta.href = decodedText;
        ta.innerHTML = decodedText;  
    }
        else ta.style.display = "none";
       tx.value = decodedText;
        var d=true;
        if(d){
       var pp=tx.value.split(" ");
          getPart(pp[0],function(r,obj){
              if(r!=null){
                tx.style.display="none";
                dor.style.display="block"   
             pno.value=r.pn
             de.value=r.des;
             mec.value=mecanico;
              }
             else{
               tx.style.display="block";
                  }
    
          });
        }


        document.getElementsByTagName("style")[0].innerHTML = s.innerHTML;
        var st = document.createElement("style");
        st.innerHTML = s;
        document.body.getElementsByTagName("style")[0] = st;
        }

    function onScanError(errorMessage) {
        // handle on error condition, with error message
    }


    function loadDoc(url, callback) {
        var xhttp = new XMLHttpRequest();
        xhttp.open("GET", url, false);
        xhttp.send();
        callback(xhttp.responseText);

    }
  //  setupinventario();
  
  function getInventories(){

    GetJ(linkp,function(obp){
        Parts=obp.parts;
     GetJ(linkm,function(obm){
         for(var i=0;i<obm.parts.length;i++){
             Parts.push(obm.parts[i])
         }
   
      GetJ(linko,function(obo){
          for(var ia=0;ia<obo.parts.length;ia++){
             Parts.push(obo.parts[ia])
         }
    
       filter();
       
      }); 
      });
      });  
 
      }
 
  
function setupinventario(){

    GetJ(linkp,function(obj){
     
      for(var i=0;i<obj.parts.length;i++){
          var s=obj.parts[i].pn;
    
          s.replace(/ /g,"_");

      }
      UpdateJ(linkp,obj,function(){alert("done")})

    })
}

function getPart(pn,callback){
  //  alert(pn)
    GetJ(linkp,function(obj){
        p=obj.parts;
        for(var i=0;i<p.length;i++){
           if(pn===p[i].pn){
             callback( p[i],obj);
             return p[i]

            }
            callback(null,null)
        
         //  
        }
     
    })

}
function send(){alert("ok");
   GetJ(linkme,function(obj){
 /*   var o={}; 
    o.qty=qt.value;
    o.jobNo=jn.value;
    o.partN=pno.value;
    o.desc=de.value;
    o.date=da.value;
    o.nota=no.value;
     o.created=new Date().toString();  */
          var o={
        "Job No.":jn.value,
      "pn": pno.value,
      "des": de.value,
      "qtyInv": qt.value,
      "qtyObs": obs.value,
      "kw": kw.value,
      "clase": cla.value,
      "createdBy": mec.value,
      "location": loc.value,
      "note": no.value,
      "created": new Date().toString()
    }; 
    
    obj.parts.push(o);
    
    
    
  //  obj.pulls.push(o);
 

    UpdateJ(linkme,obj,function(){alert("Part/s sent to Clipboard...")})


   })

}
    function GetJ(url, callback) {

//var url  = "http://localhost:8080/api/v1/users";
var xhr = new XMLHttpRequest()
xhr.open('GET', url + '/1', true)
xhr.onload = function() {
    //         (xhr.responseText)
    var users = JSON.parse(xhr.responseText);
    //     var obb=decoding(users.prim);

    if (xhr.readyState == 4 && xhr.status == "200") {
        callback(users);
    } else {
        console.error(users);
    }
}
xhr.send(null);
}

// Update a user
function UpdateJ(url, ob, callback) {
//   var o={};
//   o.prim=encoding(ob);
 // alert(obj.pulls);
json = JSON.stringify(ob);
var xhr = new XMLHttpRequest();
xhr.open("PUT", url + '/12', true);
xhr.setRequestHeader('Content-type', 'application/json; charset=utf-8');
xhr.onload = function() {
    var users = JSON.parse(xhr.responseText);
    if (xhr.readyState == 4 && xhr.status == "200") {
        //  alert("Tu Forma ha sido Enviada");
        if (callback != undefined) callback(users);
    } else {
        (users);
    }
}
xhr.send(json);
}

function search(v){
   
        if(v===""){
            dinv.style.display="none";
            }
        else{
            dinv.style.display="block";
            var pa=document.getElementsByClassName("ctt");
            for(var i=0;i<pa.length;i++){
                var s=JSON.stringify(pa[i]);
                s=s.toUpperCase();
                v=v.toUpperCase();
                if(s.indexOf(v)>-1){
                    pa[i].style.display="block"
                 //   ar.push(pa[i]);
                 }
                else{ pa[i].style.display="none"}
            }
 
}
   
 }


function filter(op){
  
                    for(var i=0;i<Parts.length;i++){
                    var p=document.createElement("p");
                    p.setAttribute("class","ctt");
                    p.style.display="block";
                    p.style.background="white";
                    p.setAttribute("onclick","sel(this);");
                    p.name=Parts[i];
                    p.id=Parts[i].pn;
                    p.innerHTML="P/N: "+Parts[i].pn+ ", Desc.: "+Parts[i].des;
                    dinv.appendChild(p);// fil.appendChild(p)
                }
              //  UpdateJ(link,obj,function(){alert('updated...')})
   }

    function sel(e){
  dor.style.display="none";
   //     alert(e.style.background)
    var enc=false; 
    
    if(e.style.background==="white"){
        for(var i=0;i<Parts.length;i++){
            if(Parts[i].pn===e.name.pn){    enc=true; 
   
                e.style.background="#0f0";
                 i=Parts.length+2;
                 
                 pno.value=e.name.pn;
                 de.value=e.name.des;
                 qt.value=e.name.qty;
                 cla.value=e.name.clase;
                 loc.value=e.name.location;
                 no.value=e.name.note;
                 mec.value=mecanico;
                 
                 
                  dor.style.display="block";
 
             }
        }
        if(!enc){
     e.style.background='white';
     Psel.push(e.name);
     
        }
        else{
            
        }
    }
   else    e.style.background='white';
    
}


</script>


<script>

/*
<div id="dor"> 
    Qty: <input id="qt" type="number" class="cin"><br>
 Inv. Class: <input id="cla" type="text" class="cin"><br>
Kw: <input id="kw" type="text" class="cin"><br>
Qty Obs: <input id="obs" type="number" class="cin"><br>

 Part No. <input id="pno" type="text" class="cin"><br>
 desc: <input id="de" type="text" class="cin"><br>
  Mech <input id="mec" type="text" class="cin"><br> 
 Loc <input id="loc" type="text" class="cin"><br> 
 Note <input id="no" type="text" class="cin"><br>     
 <button class="cpu" onclick="dor.style.display='none';send('main',dor.name)"   style="background-color: rgb(39, 221, 39);">Send To Main Inventory</button><br>
 <button class="cpu" onclick="dor.style.display='none';send('miselanius',dor.name)">Send To Miselanius</button><br>
  <button class="cpu" onclick="dor.style.display='none';send('other',dor.name)">Send To Other</button><br>
 <button class="cpu" onclick="dor.style.display='none'">Close</button>
   
</div>




    <div id="dor"> 
           Qty: <input id="qt" type="number" class="cin"><br><br>
        Job No. <input id="jn" type="text" class="cin"><br><br>

        Part No. <input id="pno" type="text" class="cin"><br><br>
        dsesc: <input id="de" type="text" class="cin"><br><br>
         Mech <input id="me" type="text" class="cin"><br> <br>  
        Date <input id="da" type="date" class="cin" value='today'><br></br>
        Note <input id="no" type="text" class="cin"><br><br>          
        <button onclick="dor.style.display='none'">Close</button>
        <button onclick="dor.style.display='none';send()">Send To Clipboard</button>        
    </div>





*/

</script>





</html>
